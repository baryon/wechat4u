{"version":3,"sources":["../src/core.js"],"names":["debug","WechatCore","PROP","uuid","uin","sid","skey","passTicket","formatedSyncKey","webwxDataTicket","syncKey","CONF","user","mediaSend","request","Promise","resolve","then","method","url","API_jsLogin","window","QRLogin","eval","res","data","equal","code","catch","err","Error","params","API_login","notEqual","redirect_uri","match","rediUri","userAvatar","fun","pm","headers","forEach","test","item","Date","BaseRequest","getBaseRequest","API_webwxinit","BaseResponse","Ret","SKey","updateSyncKey","SyncKey","Object","assign","User","to","pass_ticket","lang","API_webwxstatusnotify","API_webwxgetcontact","MemberList","contacts","length","API_webwxbatchgetcontact","ContactList","text","JSON","stringify","API_webwxreport","API_synccheck","synccheck","retcode","SYNCCHECK_RET_SUCCESS","selector","API_webwxsync","synckeylist","e","o","n","push","join","redirect","type","API_webwxlogout","msg","sendText","clientMsgId","MSGTYPE_TEXT","API_webwxsendmsg","id","MSGTYPE_EMOTICON","indexOf","Msg","MediaId","EMoticonMd5","API_webwxsendemoticon","file","name","size","lastModifiedDate","basename","path","lookup","stat","statSync","mtime","ext","mediatype","uploadMediaRequest","ClientMediaId","TotalLen","StartPos","DataLen","MediaType","UploadType","form","append","toGMTString","encodeURI","filename","contentType","knownLength","f","API_webwxuploadmedia","getHeaders","mediaId","ok","MSGTYPE_IMAGE","UserName","API_webwxsendmsgimg","MSGTYPE_VIDEO","API_webwxsendmsgvedio","APPMSGTYPE_ATTACH","API_webwxsendappmsg","msgId","MsgID","API_webwxgetmsgimg","responseType","API_webwxgetvideo","API_webwxgetvoice","HeadImgUrl","origin","Ticket","API_webwxverifyuser","ChatRoomName","AddMemberList","toString","DelMemberList","InviteMemberList","API_webwxupdatechatroom","OP","CmdId","API_webwxoplog","Uin","parseInt","Sid","Skey","DeviceID"],"mappings":"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","file":"core.js","sourcesContent":["import fs from 'fs'\nimport path from 'path'\n\nimport _debug from 'debug'\nimport FormData from 'form-data'\nimport mime from 'mime'\nimport {\n  getCONF,\n  Request,\n  isStandardBrowserEnv,\n  assert,\n  getClientMsgId,\n  getDeviceID\n} from './util'\n\nconst debug = _debug('core')\n\nexport default class WechatCore {\n\n  constructor() {\n    this.PROP = {\n      uuid: '',\n      uin: '',\n      sid: '',\n      skey: '',\n      passTicket: '',\n      formatedSyncKey: '',\n      webwxDataTicket: '',\n      syncKey: {}\n    }\n\n    this.CONF = getCONF()\n    this.user = {}\n    this.mediaSend = 0\n    this.request = new Request()\n  }\n\n  getUUID() {\n    return Promise.resolve().then(() => {\n      return this.request({\n        method: 'POST',\n        url: this.CONF.API_jsLogin\n      }).then(res => {\n        let window = {\n          QRLogin: {}\n        }\n        eval(res.data)\n        assert.equal(window.QRLogin.code, 200, res)\n\n        return this.PROP.uuid = window.QRLogin.uuid\n      })\n    }).catch(err => {\n      debug(err)\n      throw new Error('获取UUID失败')\n    })\n  }\n\n  checkLogin() {\n    return Promise.resolve().then(() => {\n      let params = {\n        'tip': 0,\n        'uuid': this.PROP.uuid,\n        'loginicon': true\n      }\n      return this.request({\n        method: 'GET',\n        url: this.CONF.API_login,\n        params: params\n      }).then(res => {\n        let window = {}\n        eval(res.data)\n        assert.notEqual(window.code, 400, res)\n        if (window.code == 200) {\n          this.CONF = getCONF(window.redirect_uri.match(/(?:\\w+\\.)+\\w+/)[0])\n          this.rediUri = window.redirect_uri\n        } else if (window.code == 201 && window.userAvatar) {\n          this.user.userAvatar = window.userAvatar\n        }\n        return window\n      })\n    }).catch(err => {\n      debug(err)\n      throw new Error('获取手机确认登录信息失败')\n    })\n  }\n\n  login() {\n    return Promise.resolve().then(() => {\n      return this.request({\n        method: 'GET',\n        url: this.rediUri,\n        params: {\n          fun: 'new'\n        }\n      }).then(res => {\n        let pm = res.data.match(/<ret>(.*)<\\/ret>/)\n        if (pm && pm[1] == 0) {\n          this.PROP.skey = res.data.match(/<skey>(.*)<\\/skey>/)[1]\n          this.PROP.sid = res.data.match(/<wxsid>(.*)<\\/wxsid>/)[1]\n          this.PROP.uin = res.data.match(/<wxuin>(.*)<\\/wxuin>/)[1]\n          this.PROP.passTicket = res.data.match(/<pass_ticket>(.*)<\\/pass_ticket>/)[1]\n        }\n        if (res.headers['set-cookie']) {\n          res.headers['set-cookie'].forEach(item => {\n            if (/webwx.*?data.*?ticket/i.test(item)) {\n              this.PROP.webwxDataTicket = item.match(/=(.*?);/)[1]\n            } else if (/wxuin/i.test(item)) {\n              this.PROP.uin = item.match(/=(.*?);/)[1]\n            } else if (/wxsid/i.test(item)) {\n              this.PROP.sid = item.match(/=(.*?);/)[1]\n            }\n          })\n        }\n      })\n    }).catch(err => {\n      debug(err)\n      throw new Error('登录失败')\n    })\n  }\n\n  init() {\n    return Promise.resolve().then(() => {\n      let params = {\n        'pass_ticket': this.PROP.passTicket,\n        'skey': this.PROP.skey,\n        'r': ~new Date()\n      }\n      let data = {\n        BaseRequest: this.getBaseRequest()\n      }\n      return this.request({\n        method: 'POST',\n        url: this.CONF.API_webwxinit,\n        params: params,\n        data: data\n      }).then(res => {\n        let data = res.data\n        assert.equal(data.BaseResponse.Ret, 0, res)\n        this.PROP.skey = data.SKey || this.PROP.skey\n        this.updateSyncKey(data.SyncKey)\n        Object.assign(this.user, data.User)\n        return this.user\n      })\n    }).catch(err => {\n      debug(err)\n      throw new Error('微信初始化失败')\n    })\n  }\n\n  notifyMobile(to) {\n    return Promise.resolve().then(() => {\n      let params = {\n        pass_ticket: this.PROP.passTicket,\n        lang: 'zh_CN'\n      }\n      let data = {\n        'BaseRequest': this.getBaseRequest(),\n        'Code': to ? 1 : 3,\n        'FromUserName': this.user['UserName'],\n        'ToUserName': to || this.user['UserName'],\n        'ClientMsgId': getClientMsgId()\n      }\n      return this.request({\n        method: 'POST',\n        url: this.CONF.API_webwxstatusnotify,\n        params: params,\n        data: data\n      }).then(res => {\n        let data = res.data\n        assert.equal(data.BaseResponse.Ret, 0, res)\n      })\n    }).catch(err => {\n      debug(err)\n      throw new Error('手机状态通知失败')\n    })\n  }\n\n  getContact() {\n    return Promise.resolve().then(() => {\n      let params = {\n        'lang': 'zh_CN',\n        'pass_ticket': this.PROP.passTicket,\n        'seq': 0,\n        'skey': this.PROP.skey,\n        'r': +new Date()\n      }\n      return this.request({\n        method: 'POST',\n        url: this.CONF.API_webwxgetcontact,\n        params: params\n      }).then(res => {\n        let data = res.data\n        assert.equal(data.BaseResponse.Ret, 0, res)\n\n        return data.MemberList\n      })\n    }).catch(err => {\n      debug(err)\n      throw new Error('获取通讯录失败')\n    })\n  }\n\n  batchGetContact(contacts) {\n    return Promise.resolve().then(() => {\n      let params = {\n        'pass_ticket': this.PROP.passTicket,\n        'type': 'ex',\n        'r': +new Date(),\n        'lang': 'zh_CN'\n      }\n      let data = {\n        'BaseRequest': this.getBaseRequest(),\n        'Count': contacts.length,\n        'List': contacts\n      }\n      return this.request({\n        method: 'POST',\n        url: this.CONF.API_webwxbatchgetcontact,\n        params: params,\n        data: data\n      }).then(res => {\n        let data = res.data\n        assert.equal(data.BaseResponse.Ret, 0, res)\n\n        return data.ContactList\n      })\n    }).catch(err => {\n      debug(err)\n      throw new Error('批量获取联系人失败')\n    })\n  }\n\n  statReport(text) {\n    return Promise.resolve().then(() => {\n      text = text || {\n        \"type\": \"[action-record]\",\n        \"data\": {\n          \"actions\": [{\n            \"type\": \"click\",\n            \"action\": \"发送框\",\n            \"time\": +new Date()\n          }]\n        }\n      }\n      text = JSON.stringify(text)\n      let params = {\n        'pass_ticket': this.PROP.passTicket,\n        'fun': 'new',\n        'lang': 'zh_CN'\n      }\n      let data = {\n        'BaseRequest': this.getBaseRequest(),\n        'Count': 1,\n        'List': [{\n          'Text': text,\n          'Type': 1\n        }]\n      }\n      return this.request({\n        method: 'POST',\n        url: this.CONF.API_webwxreport,\n        params: params,\n        data: data\n      }).then(() => {\n        return\n      })\n    }).catch(err => {\n      debug(err)\n    })\n  }\n\n  syncCheck() {\n    return Promise.resolve().then(() => {\n      let params = {\n        'r': +new Date(),\n        'sid': this.PROP.sid,\n        'uin': this.PROP.uin,\n        'skey': this.PROP.skey,\n        'deviceid': getDeviceID(),\n        'synckey': this.PROP.formatedSyncKey\n      }\n      return this.request({\n        method: 'GET',\n        url: this.CONF.API_synccheck,\n        params: params\n      }).then(res => {\n        let window = {\n          synccheck: {}\n        }\n        eval(res.data)\n        assert.equal(window.synccheck.retcode, this.CONF.SYNCCHECK_RET_SUCCESS, res)\n\n        return window.synccheck.selector\n      })\n    }).catch(err => {\n      debug(err)\n      throw new Error('同步失败')\n    })\n  }\n\n  sync() {\n    return Promise.resolve().then(() => {\n      let params = {\n        'sid': this.PROP.sid,\n        'skey': this.PROP.skey,\n        'pass_ticket': this.PROP.passTicket,\n        'lang': 'zh_CN'\n      }\n      let data = {\n        'BaseRequest': this.getBaseRequest(),\n        'SyncKey': this.PROP.syncKey,\n        'rr': ~new Date()\n      }\n      return this.request({\n        method: 'POST',\n        url: this.CONF.API_webwxsync,\n        params: params,\n        data: data\n      }).then(res => {\n        let data = res.data\n        assert.equal(data.BaseResponse.Ret, 0, res)\n\n        this.updateSyncKey(data['SyncKey'])\n        this.PROP.skey = data.SKey || this.PROP.skey\n        return data\n      })\n    }).catch(err => {\n      debug(err)\n      throw new Error('获取新信息失败')\n    })\n  }\n\n  updateSyncKey(syncKey) {\n    this.PROP.syncKey = syncKey\n    let synckeylist = []\n    for (let e = this.PROP.syncKey['List'], o = 0, n = e.length; n > o; o++) {\n      synckeylist.push(e[o]['Key'] + '_' + e[o]['Val'])\n    }\n    this.PROP.formatedSyncKey = synckeylist.join('|')\n  }\n\n  logout() {\n    return Promise.resolve().then(() => {\n      let params = {\n        redirect: 1,\n        type: 0,\n        skey: this.PROP.skey,\n        lang: 'zh_CN'\n      }\n\n      // data加上会出错，不加data也能登出\n      // let data = {\n      //   sid: this.PROP.sid,\n      //   uin: this.PROP.uin\n      // }\n      return this.request({\n        method: 'POST',\n        url: this.CONF.API_webwxlogout,\n        params: params\n      }).then(res => {\n        return '登出成功'\n      }).catch(err => {\n        debug(err)\n        return '可能登出成功'\n      })\n    })\n  }\n\n  sendMsg(msg, to) {\n    return this.sendText(msg, to)\n  }\n\n  sendText(msg, to) {\n    return Promise.resolve().then(() => {\n      let params = {\n        'pass_ticket': this.PROP.passTicket,\n        'lang': 'zh_CN'\n      }\n      let clientMsgId = getClientMsgId()\n      let data = {\n        'BaseRequest': this.getBaseRequest(),\n        'Scene': 0,\n        'Msg': {\n          'Type': this.CONF.MSGTYPE_TEXT,\n          'Content': msg,\n          'FromUserName': this.user['UserName'],\n          'ToUserName': to,\n          'LocalID': clientMsgId,\n          'ClientMsgId': clientMsgId\n        }\n      }\n      this.request({\n        method: 'POST',\n        url: this.CONF.API_webwxsendmsg,\n        params: params,\n        data: data\n      }).then(res => {\n        let data = res.data\n        assert.equal(data.BaseResponse.Ret, 0, res)\n      })\n    }).catch(err => {\n      debug(err)\n      throw new Error('发送文本信息失败')\n    })\n  }\n\n  sendEmoticon(id, to) {\n    return Promise.resolve().then(() => {\n      let params = {\n        'fun': 'sys',\n        'pass_ticket': this.PROP.passTicket,\n        'lang': 'zh_CN'\n      }\n      let clientMsgId = getClientMsgId()\n      let data = {\n        'BaseRequest': this.getBaseRequest(),\n        'Scene': 0,\n        'Msg': {\n          'Type': this.CONF.MSGTYPE_EMOTICON,\n          'EmojiFlag': 2,\n          'FromUserName': this.user['UserName'],\n          'ToUserName': to,\n          'LocalID': clientMsgId,\n          'ClientMsgId': clientMsgId\n        },\n        'Scene': 0\n      }\n\n      if (id.indexOf('@') === 0) {\n        data.Msg.MediaId = id\n      } else {\n        data.Msg.EMoticonMd5 = id\n      }\n\n      this.request({\n        method: 'POST',\n        url: this.CONF.API_webwxsendemoticon,\n        params: params,\n        data: data\n      }).then(res => {\n        let data = res.data\n        assert.equal(data.BaseResponse.Ret, 0, res)\n      })\n    }).catch(err => {\n      debug(err)\n      throw new Error('发送表情信息失败')\n    })\n  }\n\n  // file: Stream, File\n  uploadMedia(file) {\n    return Promise.resolve().then(() => {\n      let name, type, size, lastModifiedDate\n      if (isStandardBrowserEnv) {\n        name = file.name\n        type = file.type\n        size = file.size\n        lastModifiedDate = file.lastModifiedDate\n      } else {\n        name = path.basename(file.path)\n        type = mime.lookup(name)\n        let stat = fs.statSync(file.path)\n        size = stat.size\n        lastModifiedDate = stat.mtime\n      }\n\n      let ext = name.match(/.*\\.(.*)/)\n      if (ext) {\n        ext = ext[1]\n      }\n\n      let mediatype\n      switch (ext) {\n        case 'bmp':\n        case 'jpeg':\n        case 'jpg':\n        case 'png':\n          mediatype = 'pic'\n          break\n        case 'mp4':\n          mediatype = 'video'\n          break\n        default:\n          mediatype = 'doc'\n      }\n\n      let clientMsgId = getClientMsgId()\n\n      let uploadMediaRequest = JSON.stringify({\n        BaseRequest: this.getBaseRequest(),\n        ClientMediaId: clientMsgId,\n        TotalLen: size,\n        StartPos: 0,\n        DataLen: size,\n        MediaType: 4,\n        UploadType: 2\n      })\n\n      let form = new FormData()\n      form.append('id', 'WU_FILE_' + this.mediaSend++)\n      form.append('name', name)\n      form.append('type', type)\n      form.append('lastModifiedDate', lastModifiedDate.toGMTString())\n      form.append('size', size)\n      form.append('mediatype', mediatype)\n      form.append('uploadmediarequest', uploadMediaRequest)\n      form.append('webwx_data_ticket', this.PROP.webwxDataTicket)\n      form.append('pass_ticket', encodeURI(this.PROP.passTicket))\n      form.append('filename', file, {\n        filename: name,\n        contentType: type,\n        knownLength: size\n      })\n\n      let params = {\n        f: 'json'\n      }\n\n      return this.request({\n        method: 'POST',\n        url: this.CONF.API_webwxuploadmedia,\n        headers: form.getHeaders(),\n        params: params,\n        data: form\n      }).then(res => {\n        let data = res.data\n        let mediaId = data.MediaId\n        assert.ok(mediaId, res)\n\n        return {\n          name: name,\n          size: size,\n          ext: ext,\n          mediatype: mediatype,\n          mediaId: mediaId\n        }\n      })\n    }).catch(err => {\n      debug(err)\n      throw new Error('上传媒体文件失败')\n    })\n  }\n\n  sendPic(mediaId, to) {\n    return Promise.resolve().then(() => {\n      let params = {\n        'pass_ticket': this.PROP.passTicket,\n        'fun': 'async',\n        'f': 'json',\n        'lang': 'zh_CN'\n      }\n      let clientMsgId = getClientMsgId()\n      let data = {\n        'BaseRequest': this.getBaseRequest(),\n        'Scene': 0,\n        'Msg': {\n          'Type': this.CONF.MSGTYPE_IMAGE,\n          'MediaId': mediaId,\n          'FromUserName': this.user.UserName,\n          'ToUserName': to,\n          'LocalID': clientMsgId,\n          'ClientMsgId': clientMsgId\n        }\n      }\n      return this.request({\n        method: 'POST',\n        url: this.CONF.API_webwxsendmsgimg,\n        params: params,\n        data: data\n      }).then(res => {\n        let data = res.data\n        assert.equal(data.BaseResponse.Ret, 0, res)\n      })\n    }).catch(err => {\n      debug(err)\n      throw new Error('发送图片失败')\n    })\n  }\n\n  sendVideo(mediaId, to) {\n    return Promise.resolve().then(() => {\n      let params = {\n        'pass_ticket': this.PROP.passTicket,\n        'fun': 'async',\n        'f': 'json',\n        'lang': 'zh_CN'\n      }\n      let clientMsgId = getClientMsgId()\n      let data = {\n        'BaseRequest': this.getBaseRequest(),\n        'Scene': 0,\n        'Msg': {\n          'Type': this.CONF.MSGTYPE_VIDEO,\n          'MediaId': mediaId,\n          'FromUserName': this.user.UserName,\n          'ToUserName': to,\n          'LocalID': clientMsgId,\n          'ClientMsgId': clientMsgId\n        }\n      }\n      return this.request({\n        method: 'POST',\n        url: this.CONF.API_webwxsendmsgvedio,\n        params: params,\n        data: data\n      }).then(res => {\n        let data = res.data\n        assert.equal(data.BaseResponse.Ret, 0, res)\n      })\n    }).catch(err => {\n      debug(err)\n      throw new Error('发送视频失败')\n    })\n  }\n\n  sendDoc(mediaId, name, size, ext, to) {\n    return Promise.resolve().then(() => {\n      let params = {\n        'pass_ticket': this.PROP.passTicket,\n        'fun': 'async',\n        'f': 'json',\n        'lang': 'zh_CN'\n      }\n      let clientMsgId = getClientMsgId()\n      let data = {\n        'BaseRequest': this.getBaseRequest(),\n        'Scene': 0,\n        'Msg': {\n          'Type': this.CONF.APPMSGTYPE_ATTACH,\n          'Content': `<appmsg appid='wxeb7ec651dd0aefa9' sdkver=''><title>${name}</title><des></des><action></action><type>6</type><content></content><url></url><lowurl></lowurl><appattach><totallen>${size}</totallen><attachid>${mediaId}</attachid><fileext>${ext}</fileext></appattach><extinfo></extinfo></appmsg>`,\n          'FromUserName': this.user.UserName,\n          'ToUserName': to,\n          'LocalID': clientMsgId,\n          'ClientMsgId': clientMsgId\n        }\n      }\n      return this.request({\n        method: 'POST',\n        url: this.CONF.API_webwxsendappmsg,\n        params: params,\n        data: data\n      }).then(res => {\n        let data = res.data\n        assert.equal(data.BaseResponse.Ret, 0, res)\n      })\n    }).catch(err => {\n      debug(err)\n      throw new Error('发送文件失败')\n    })\n  }\n\n  getMsgImg(msgId) {\n    return Promise.resolve().then(() => {\n      let params = {\n        MsgID: msgId,\n        skey: this.PROP.skey,\n        type: 'big'\n      }\n\n      return this.request({\n        method: 'GET',\n        url: this.CONF.API_webwxgetmsgimg,\n        params: params,\n        responseType: 'arraybuffer'\n      }).then(res => {\n        return {\n          data: res.data,\n          type: res.headers['content-type']\n        }\n      })\n    }).catch(err => {\n      debug(err)\n      throw new Error('获取图片或表情失败')\n    })\n  }\n\n  getVideo(msgId) {\n    return Promise.resolve().then(() => {\n      let params = {\n        MsgID: msgId,\n        skey: this.PROP.skey\n      }\n\n      return this.request({\n        method: 'GET',\n        url: this.CONF.API_webwxgetvideo,\n        headers: {\n          'Range': 'bytes=0-'\n        },\n        params: params,\n        responseType: 'arraybuffer'\n      }).then(res => {\n        return {\n          data: res.data,\n          type: res.headers['content-type']\n        }\n      })\n    }).catch(err => {\n      debug(err)\n      throw new Error('获取视频失败')\n    })\n  }\n\n  getVoice(msgId) {\n    return Promise.resolve().then(() => {\n      let params = {\n        MsgID: msgId,\n        skey: this.PROP.skey\n      }\n\n      return this.request({\n        method: 'GET',\n        url: this.CONF.API_webwxgetvoice,\n        params: params,\n        responseType: 'arraybuffer'\n      }).then(res => {\n        return {\n          data: res.data,\n          type: res.headers['content-type']\n        }\n      })\n    }).catch(err => {\n      debug(err)\n      throw new Error('获取声音失败')\n    })\n  }\n\n  getHeadImg(HeadImgUrl) {\n    return Promise.resolve().then(() => {\n      let url = this.CONF.origin + HeadImgUrl\n      return this.request({\n        method: 'GET',\n        url: url,\n        responseType: 'arraybuffer'\n      }).then(res => {\n        return {\n          data: res.data,\n          type: res.headers['content-type']\n        }\n      })\n    }).catch(err => {\n      debug(err)\n      throw new Error('获取头像失败')\n    })\n  }\n\n  verifyUser(UserName, Ticket) {\n    return Promise.resolve().then(() => {\n      let params = {\n        'pass_ticket': this.PROP.passTicket,\n        'lang': 'zh_CN'\n      }\n      let data = {\n        'BaseRequest': this.getBaseRequest(),\n        'Opcode': 3,\n        'VerifyUserListSize': 1,\n        'VerifyUserList': [{\n          'Value': UserName,\n          'VerifyUserTicket': Ticket\n        }],\n        'VerifyContent': '',\n        'SceneListCount': 1,\n        'SceneList': [33],\n        'skey': this.PROP.skey\n      }\n      return this.request({\n        method: 'POST',\n        url: this.CONF.API_webwxverifyuser,\n        params: params,\n        data: data\n      }).then(res => {\n        let data = res.data\n        assert.equal(data.BaseResponse.Ret, 0, res)\n      })\n    }).catch(err => {\n      debug(err)\n      throw new Error('通过好友请求失败')\n    })\n  }\n\n  // fun: 'addmember' or 'delmember' or 'invitemember'\n  updateChatroom(ChatRoomName, MemberList, fun) {\n    return Promise.resolve().then(() => {\n      let params = {\n        fun: fun\n      }\n      let data = {\n        BaseRequest: this.getBaseRequest(),\n        ChatRoomName: ChatRoomName\n      }\n      if (fun == 'addmember') {\n        data.AddMemberList = MemberList.toString()\n      } else if (fun == 'delmember') {\n        data.DelMemberList = MemberList.toString()\n      } else if (fun == 'invitemember') {\n        data.InviteMemberList = MemberList.toString()\n      }\n      return this.request({\n        method: 'POST',\n        url: this.CONF.API_webwxupdatechatroom,\n        params: params,\n        data: data\n      }).then(res => {\n        let data = res.data\n        assert.equal(data.BaseResponse.Ret, 0, res)\n      })\n    }).catch(err => {\n      debug(err)\n      throw new Error('邀请或踢出群成员失败')\n    })\n  }\n\n  // OP: 1 联系人置顶 0 取消置顶\n  opLog(UserName, OP) {\n    return Promise.resolve().then(() => {\n      let params = {\n        pass_ticket: this.PROP.passTicket\n      }\n      let data = {\n        BaseRequest: this.getBaseRequest(),\n        CmdId: 3,\n        OP: OP,\n        UserName: UserName\n      }\n      return this.request({\n        method: 'POST',\n        url: this.CONF.API_webwxoplog,\n        params: params,\n        data: data\n      }).then(res => {\n        let data = res.data\n        assert.equal(data.BaseResponse.Ret, 0, res)\n      })\n    }).catch(err => {\n      debug(err)\n      throw new Error('置顶或取消置顶失败')\n    })\n  }\n\n  getBaseRequest() {\n    return {\n      Uin: parseInt(this.PROP.uin),\n      Sid: this.PROP.sid,\n      Skey: this.PROP.skey,\n      DeviceID: getDeviceID()\n    }\n  }\n}\n"]}